    tic
    clear,clc
    load('desired trajectory.mat')
    load('result_DP+GA.mat')      %/ rad   gama_x+
        tic
        x_init =  X_DP_GA;
        bili = 0.2;     % 范围上下放缩0.2
        for j = 1:length(x_init)
                a = sort([(1-bili)*x_init(j),(1+bili)*x_init(j)]);
                lb(j) = a(1);
                ub(j) = a(2);
        end
        options = optimset('Algorith','SQP');
        X_DP_GA_SQP(1,:) = fmincon(@TargetFunction,x_init,[],[],[],[],lb,ub,@YueShu);
    toc
    

    close all
    x = X_DP_GA_SQP(1,:);
    xh_t = [0,0.000344146924571766,0.00275266660271188,0.00928738849027486,0.0220050585810181,0.0429548055050272,0.0741756160116888,0.117693822947412,0.175520608822920,0.249649528045654,0.342054050869947,0.454685132090775,0.589468807476422,0.748303820901325,0.933059285102357,1.14557237894056,1.38764608400526,1.66104696334906,1.96750298509031,2.30870139356434,2.68628663064626,3.10185830980609,3.55696924539237,4.05312353957208,4.59177472928365,5.17432399548618,5.80211843691094,6.47644941044200,7.19855094017043,7.96959819708236,8.79070605125373,9.66292769833548,10.5872533620214,11.5646090740971,12.5958555335730,13.6817870463075,14.8231305464251,16.0205447007378,17.2746190972700,18.5858735188889,19.9547573029345,21.3816487876382,22.8668548460113,24.4106105077797,26.0130786698275,27.6743498955095,29.3944423030770,31.1733015433567,33.0108008667081,34.9067412791791,36.8608517876649,38.8727897337710,40.9421412159662,43.0684215995077,45.2510761135086,47.4894805344133,49.7829419550381,52.1306996382293,54.5319259540883,56.9857273996074,59.4911456994618,62.0471589866000,64.6526830611796,67.3065727262963,70.0076231988613,72.7545715938886,75.5460984803631,78.3808295067740,81.2573370943094,84.1741421956265,87.1297161170316,90.1224824018231,93.1508187724796,96.2130591292976,99.3074956030191,102.432380658919,105.585929249758,108.766321014956,111.971702523263,115.200189556184,118.449869429323,121.718803348801,125.005028799844,128.306561964591,131.621400166149,134.947524335879,138.282901500882,141.625487288613,144.973228445536,148.324065366722,151.675934633278,155.026771554464,158.374512711387,161.717098499118,165.052475664121,168.378599833851,171.693438035409,174.994971200156,178.281196651199,181.550130570677,184.799810443816,188.028297476737,191.233678985044,194.414070750242,197.567619341081,200.692504396981,203.786940870702,206.849181227520,209.877517598177,212.870283882968,215.825857804373,218.742662905691,221.619170493226,224.453901519637,227.245428406111,229.992376801139,232.693427273704,235.347316938820,237.952841013400,240.508854300538,243.014272600393,245.468074045912,247.869300361771,250.217058044962,252.510519465587,254.748923886491,256.931578400492,259.057858784034,261.127210266229,263.139148212335,265.093258720821,266.989199133292,268.826698456643,270.605557696923,272.325650104491,273.986921330172,275.589389492220,277.133145153989,278.618351212362,280.045242697066,281.414126481111,282.725380902730,283.979455299262,285.176869453575,286.318212953693,287.404144466427,288.435390925903,289.412746637979,290.337072301665,291.209293948746,292.030401802918,292.801449059830,293.523550589558,294.197881563089,294.825676004514,295.408225270716,295.946876460428,296.443030754608,296.898141690194,297.313713369354,297.691298606436,298.032497014910,298.338953036651,298.612353915995,298.854427621060,299.066940714898,299.251696179099,299.410531192524,299.545314867909,299.657945949130,299.750350471954,299.824479391177,299.882306177053,299.925824383988,299.957045194495,299.977994941419,299.990712611510,299.997247333397,299.999655853075,300,300,298.333333333333,296.666666666667,295,293.333333333333,291.666666666667,290,288.333333333333,286.666666666667,285,283.333333333333,281.666666666667,280,278.333333333333,276.666666666667,275,273.333333333333,271.666666666667,270,268.333333333333,266.666666666667,265,263.333333333333,261.666666666667,260,258.333333333333,256.666666666667,255,253.333333333333,251.666666666667,250,248.333333333333,246.666666666667,245,243.333333333333,241.666666666667,240,238.333333333333,236.666666666667,235,233.333333333333,231.666666666667,230,228.333333333333,226.666666666667,225,223.333333333333,221.666666666667,220,218.333333333333,216.666666666667,215,213.333333333333,211.666666666667,210,208.333333333333,206.666666666667,205,203.333333333333,201.666666666667,200,198.333333333333,196.666666666667,195,193.333333333333,191.666666666667,190,188.333333333333,186.666666666667,185,183.333333333333,181.666666666667,180,178.333333333333,176.666666666667,175,173.333333333333,171.666666666667,170,168.333333333333,166.666666666667,165,163.333333333333,161.666666666667,160,158.333333333333,156.666666666667,155,153.333333333333,151.666666666667,150,148.333333333333,146.666666666667,145,143.333333333333,141.666666666667,140,138.333333333333,136.666666666667,135,133.333333333333,131.666666666667,130,128.333333333333,126.666666666667,125,123.333333333333,121.666666666667,120,118.333333333333,116.666666666667,115,113.333333333333,111.666666666667,110,108.333333333333,106.666666666667,105,103.333333333333,101.666666666667,100,98.3333333333333,96.6666666666667,95,93.3333333333333,91.6666666666667,90,88.3333333333333,86.6666666666667,85,83.3333333333333,81.6666666666667,80,78.3333333333333,76.6666666666667,75,73.3333333333333,71.6666666666667,70,68.3333333333333,66.6666666666667,65,63.3333333333333,61.6666666666667,60,58.3333333333333,56.6666666666667,55,53.3333333333333,51.6666666666667,50,48.3333333333333,46.6666666666667,45,43.3333333333333,41.6666666666667,40,38.3333333333333,36.6666666666667,35,33.3333333333333,31.6666666666667,30,28.3333333333333,26.6666666666667,25,23.3333333333333,21.6666666666667,20,18.3333333333333,16.6666666666667,15,13.3333333333333,11.6666666666667,10,8.33333333333333,6.66666666666667,5,3.33333333333333,1.66666666666667];
    yh_t = -[0,0.0307998847197954,0.123161593563231,0.276971337330917,0.492039623127771,0.768101487817419,1.10481682445555,1.50177080130007,1.95847437288197,2.47436488250700,3.04880675544618,3.68109228196093,4.37044248919818,5.11600810088134,5.91687058361479,6.77204327851275,7.68047261675846,8.64103941759618,9.65256026715664,10.7137889764175,11.8234181165026,12.9800806294279,14.1823515123112,15.4287495729688,16.7177392547372,18.0477325282723,19.4170908479940,20.8241271707669,22.2671080343293,23.7442556929114,25.2537503074090,26.7937321874178,28.3623040823628,29.9575335189024,31.5774551817267,33.2200733348169,34.8833642801829,36.5652788510498,38.2637449364219,39.9766700339140,41.7019438277046,43.4374407884355,45.1810227918536,46.9305417529709,48.6838422724947,50.4387642922696,52.1931457564597,53.9448252751909,55.6916447873735,57.4314522194233,59.1621041366068,60.8814683837424,62.5874267120060,64.2778773886036,65.9507377860967,67.6039469481895,69.2354681288176,70.8432913014097,72.4254356352313,73.9799519357586,75.5049250460776,76.9984762063483,78.4587653684284,79.8839934628039,81.2724046150346,82.6222883089831,83.9319814941631,85.1998706346097,86.4243936967484,87.6040420738132,88.7373624444431,89.8229585631675,90.8594929805740,91.8456886910401,92.7803307059980,93.6622675507951,94.4904126833055,95.2637458325445,95.9813142556385,96.6422339115989,97.2456905504572,97.7909407164171,98.2773126637884,98.7042071845746,99.0710983466946,99.3775341419286,99.6231370427898,99.8076044676369,99.9307091534531,99.9922994358332,99.9922994358332,99.9307091534531,99.8076044676369,99.6231370427898,99.3775341419286,99.0710983466946,98.7042071845746,98.2773126637884,97.7909407164171,97.2456905504572,96.6422339115989,95.9813142556385,95.2637458325445,94.4904126833055,93.6622675507951,92.7803307059980,91.8456886910401,90.8594929805740,89.8229585631675,88.7373624444431,87.6040420738132,86.4243936967484,85.1998706346097,83.9319814941631,82.6222883089831,81.2724046150346,79.8839934628039,78.4587653684284,76.9984762063483,75.5049250460776,73.9799519357586,72.4254356352313,70.8432913014097,69.2354681288176,67.6039469481895,65.9507377860967,64.2778773886036,62.5874267120060,60.8814683837425,59.1621041366069,57.4314522194233,55.6916447873735,53.9448252751909,52.1931457564597,50.4387642922696,48.6838422724947,46.9305417529710,45.1810227918536,43.4374407884355,41.7019438277046,39.9766700339140,38.2637449364219,36.5652788510498,34.8833642801829,33.2200733348169,31.5774551817267,29.9575335189024,28.3623040823628,26.7937321874178,25.2537503074090,23.7442556929114,22.2671080343294,20.8241271707669,19.4170908479940,18.0477325282723,16.7177392547372,15.4287495729688,14.1823515123112,12.9800806294279,11.8234181165026,10.7137889764175,9.65256026715662,8.64103941759617,7.68047261675846,6.77204327851275,5.91687058361480,5.11600810088134,4.37044248919818,3.68109228196094,3.04880675544619,2.47436488250700,1.95847437288199,1.50177080130008,1.10481682445555,0.768101487817424,0.492039623127771,0.276971337330917,0.123161593563237,0.0307998847197954,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    [f,xh_o,yh_o] = TargetFunction(x)
    [index1,index2,h3,theta1,imp1] = zusers_get_parameters(xh_o,yh_o);
    f
    S = h3/(max(xh_t) - min(xh_t))
    imp1
    toc
    
%...画图
    scatter(xh_o(1:4:end),yh_o(1:4:end),'filled');     hold on;    set (gca,'YDir','reverse');    axis equal
    plot(xh_t,yh_t)    
    
%...网格
    grid on
    set(gca,'GridLineStyle',':') % grid虚线
    set(gca,'GridColor','k','GridAlpha',1) % grid黑色，透明度1
    set(gca,'XMinorGrid','off')   % 次网格线
    
%...坐标轴
    set(gca,'XLim',[-20,320]);          % X范围  
    set(gca,'YLim',[-120,20]);          % X范围  
    xlabel('{\itTime} (s)','FontWeight','Normal','FontSize',10.5) %xlabel
    ylabel('{\itTime} (s)','FontWeight','Normal','FontSize',10.5) %xlabel
    xlabel('\rm\fontname{normal}狗')  % 狗正体
    xlabel('\it\fontname{Times New Roman}x(mm)')  % 狗斜体
    ylabel('\it\fontname{Times New Roman}y(mm)')  % 狗斜体

%...字体字号
    set(gca,'Fontname', 'Times New Roman'); % 字体
    set(gca,'FontSize',10.5); % 字号
    set(gca,'FontWeight','bold'); % 加粗了（刻度、坐标名，legend）

%...窗口位置和大小
    set(gcf,'unit','centimeters','position',[1,2,10,8])   % figure在窗口的位置 1 2是位置，20 15是大小
    set(gca,'LooseInset',get(gca,'TightInset'))   % 去掉多余空白，仅单图可用
    set(gca,'looseInset',[0 0 0 0])               % 去掉多余空白，仅单图可用
    
    
    
    
    
    
    
%% 子函数
% 目标函数 x为优化变量，不属于优化变脸的可以用global引用
    function [f,xh_o,yh_o] = TargetFunction(x)
    global index_cal i
    index_cal = index_cal + 1;
    disp(['正在计算目标函数',num2str(index_cal),'====正在进行第',num2str(1),'次循环'])       
    try    
        xa = x(1);     ya = x(2);    r1 = x(3);    r2 = x(4);
        r3 = x(5);     r4 = x(6);    a1 = x(7);    b1 = x(8);
        a2 = x(9);     b2 = x(10);   r9 = x(11);   r10 = x(12);
        a3 = x(13);    b3 = x(14);
        beta = x(15);    gama_x = x(16);   % rad 

        delta_phi = 2*pi/360;  % rad
        xh_o = [];
        yh_o = [];
        j = 0;
        for phi =  gama_x  : delta_phi : 2*pi + gama_x - delta_phi  
            j = j+1;
            [xb,yb] = crank(xa,ya,r1,phi);
            xd = xa + r4*cos(beta);
            yd = ya + r4*sin(beta);
            [xc,yc,phiBC,phiDC] = RRR(xb,yb,xd,yd,r2,r3,1);
            [xe,ye] = rigid_body(xa,ya,phi,a1,b1,1);                      
            [xg,yg] = rigid_body(xd,yd,phiDC,a2,b2,-1);        
            [xf,yf,phiEF,phiGF] = RRR(xe,ye,xg,yg,r10,r9,1);
            [xh_o(j),yh_o(j)] = rigid_body(xe,ye,phiEF,a3,b3,1);
        end
            xh_t = [0,0.000344146924571766,0.00275266660271188,0.00928738849027486,0.0220050585810181,0.0429548055050272,0.0741756160116888,0.117693822947412,0.175520608822920,0.249649528045654,0.342054050869947,0.454685132090775,0.589468807476422,0.748303820901325,0.933059285102357,1.14557237894056,1.38764608400526,1.66104696334906,1.96750298509031,2.30870139356434,2.68628663064626,3.10185830980609,3.55696924539237,4.05312353957208,4.59177472928365,5.17432399548618,5.80211843691094,6.47644941044200,7.19855094017043,7.96959819708236,8.79070605125373,9.66292769833548,10.5872533620214,11.5646090740971,12.5958555335730,13.6817870463075,14.8231305464251,16.0205447007378,17.2746190972700,18.5858735188889,19.9547573029345,21.3816487876382,22.8668548460113,24.4106105077797,26.0130786698275,27.6743498955095,29.3944423030770,31.1733015433567,33.0108008667081,34.9067412791791,36.8608517876649,38.8727897337710,40.9421412159662,43.0684215995077,45.2510761135086,47.4894805344133,49.7829419550381,52.1306996382293,54.5319259540883,56.9857273996074,59.4911456994618,62.0471589866000,64.6526830611796,67.3065727262963,70.0076231988613,72.7545715938886,75.5460984803631,78.3808295067740,81.2573370943094,84.1741421956265,87.1297161170316,90.1224824018231,93.1508187724796,96.2130591292976,99.3074956030191,102.432380658919,105.585929249758,108.766321014956,111.971702523263,115.200189556184,118.449869429323,121.718803348801,125.005028799844,128.306561964591,131.621400166149,134.947524335879,138.282901500882,141.625487288613,144.973228445536,148.324065366722,151.675934633278,155.026771554464,158.374512711387,161.717098499118,165.052475664121,168.378599833851,171.693438035409,174.994971200156,178.281196651199,181.550130570677,184.799810443816,188.028297476737,191.233678985044,194.414070750242,197.567619341081,200.692504396981,203.786940870702,206.849181227520,209.877517598177,212.870283882968,215.825857804373,218.742662905691,221.619170493226,224.453901519637,227.245428406111,229.992376801139,232.693427273704,235.347316938820,237.952841013400,240.508854300538,243.014272600393,245.468074045912,247.869300361771,250.217058044962,252.510519465587,254.748923886491,256.931578400492,259.057858784034,261.127210266229,263.139148212335,265.093258720821,266.989199133292,268.826698456643,270.605557696923,272.325650104491,273.986921330172,275.589389492220,277.133145153989,278.618351212362,280.045242697066,281.414126481111,282.725380902730,283.979455299262,285.176869453575,286.318212953693,287.404144466427,288.435390925903,289.412746637979,290.337072301665,291.209293948746,292.030401802918,292.801449059830,293.523550589558,294.197881563089,294.825676004514,295.408225270716,295.946876460428,296.443030754608,296.898141690194,297.313713369354,297.691298606436,298.032497014910,298.338953036651,298.612353915995,298.854427621060,299.066940714898,299.251696179099,299.410531192524,299.545314867909,299.657945949130,299.750350471954,299.824479391177,299.882306177053,299.925824383988,299.957045194495,299.977994941419,299.990712611510,299.997247333397,299.999655853075,300,300,298.333333333333,296.666666666667,295,293.333333333333,291.666666666667,290,288.333333333333,286.666666666667,285,283.333333333333,281.666666666667,280,278.333333333333,276.666666666667,275,273.333333333333,271.666666666667,270,268.333333333333,266.666666666667,265,263.333333333333,261.666666666667,260,258.333333333333,256.666666666667,255,253.333333333333,251.666666666667,250,248.333333333333,246.666666666667,245,243.333333333333,241.666666666667,240,238.333333333333,236.666666666667,235,233.333333333333,231.666666666667,230,228.333333333333,226.666666666667,225,223.333333333333,221.666666666667,220,218.333333333333,216.666666666667,215,213.333333333333,211.666666666667,210,208.333333333333,206.666666666667,205,203.333333333333,201.666666666667,200,198.333333333333,196.666666666667,195,193.333333333333,191.666666666667,190,188.333333333333,186.666666666667,185,183.333333333333,181.666666666667,180,178.333333333333,176.666666666667,175,173.333333333333,171.666666666667,170,168.333333333333,166.666666666667,165,163.333333333333,161.666666666667,160,158.333333333333,156.666666666667,155,153.333333333333,151.666666666667,150,148.333333333333,146.666666666667,145,143.333333333333,141.666666666667,140,138.333333333333,136.666666666667,135,133.333333333333,131.666666666667,130,128.333333333333,126.666666666667,125,123.333333333333,121.666666666667,120,118.333333333333,116.666666666667,115,113.333333333333,111.666666666667,110,108.333333333333,106.666666666667,105,103.333333333333,101.666666666667,100,98.3333333333333,96.6666666666667,95,93.3333333333333,91.6666666666667,90,88.3333333333333,86.6666666666667,85,83.3333333333333,81.6666666666667,80,78.3333333333333,76.6666666666667,75,73.3333333333333,71.6666666666667,70,68.3333333333333,66.6666666666667,65,63.3333333333333,61.6666666666667,60,58.3333333333333,56.6666666666667,55,53.3333333333333,51.6666666666667,50,48.3333333333333,46.6666666666667,45,43.3333333333333,41.6666666666667,40,38.3333333333333,36.6666666666667,35,33.3333333333333,31.6666666666667,30,28.3333333333333,26.6666666666667,25,23.3333333333333,21.6666666666667,20,18.3333333333333,16.6666666666667,15,13.3333333333333,11.6666666666667,10,8.33333333333333,6.66666666666667,5,3.33333333333333,1.66666666666667];
            yh_t = -[0,0.0307998847197954,0.123161593563231,0.276971337330917,0.492039623127771,0.768101487817419,1.10481682445555,1.50177080130007,1.95847437288197,2.47436488250700,3.04880675544618,3.68109228196093,4.37044248919818,5.11600810088134,5.91687058361479,6.77204327851275,7.68047261675846,8.64103941759618,9.65256026715664,10.7137889764175,11.8234181165026,12.9800806294279,14.1823515123112,15.4287495729688,16.7177392547372,18.0477325282723,19.4170908479940,20.8241271707669,22.2671080343293,23.7442556929114,25.2537503074090,26.7937321874178,28.3623040823628,29.9575335189024,31.5774551817267,33.2200733348169,34.8833642801829,36.5652788510498,38.2637449364219,39.9766700339140,41.7019438277046,43.4374407884355,45.1810227918536,46.9305417529709,48.6838422724947,50.4387642922696,52.1931457564597,53.9448252751909,55.6916447873735,57.4314522194233,59.1621041366068,60.8814683837424,62.5874267120060,64.2778773886036,65.9507377860967,67.6039469481895,69.2354681288176,70.8432913014097,72.4254356352313,73.9799519357586,75.5049250460776,76.9984762063483,78.4587653684284,79.8839934628039,81.2724046150346,82.6222883089831,83.9319814941631,85.1998706346097,86.4243936967484,87.6040420738132,88.7373624444431,89.8229585631675,90.8594929805740,91.8456886910401,92.7803307059980,93.6622675507951,94.4904126833055,95.2637458325445,95.9813142556385,96.6422339115989,97.2456905504572,97.7909407164171,98.2773126637884,98.7042071845746,99.0710983466946,99.3775341419286,99.6231370427898,99.8076044676369,99.9307091534531,99.9922994358332,99.9922994358332,99.9307091534531,99.8076044676369,99.6231370427898,99.3775341419286,99.0710983466946,98.7042071845746,98.2773126637884,97.7909407164171,97.2456905504572,96.6422339115989,95.9813142556385,95.2637458325445,94.4904126833055,93.6622675507951,92.7803307059980,91.8456886910401,90.8594929805740,89.8229585631675,88.7373624444431,87.6040420738132,86.4243936967484,85.1998706346097,83.9319814941631,82.6222883089831,81.2724046150346,79.8839934628039,78.4587653684284,76.9984762063483,75.5049250460776,73.9799519357586,72.4254356352313,70.8432913014097,69.2354681288176,67.6039469481895,65.9507377860967,64.2778773886036,62.5874267120060,60.8814683837425,59.1621041366069,57.4314522194233,55.6916447873735,53.9448252751909,52.1931457564597,50.4387642922696,48.6838422724947,46.9305417529710,45.1810227918536,43.4374407884355,41.7019438277046,39.9766700339140,38.2637449364219,36.5652788510498,34.8833642801829,33.2200733348169,31.5774551817267,29.9575335189024,28.3623040823628,26.7937321874178,25.2537503074090,23.7442556929114,22.2671080343294,20.8241271707669,19.4170908479940,18.0477325282723,16.7177392547372,15.4287495729688,14.1823515123112,12.9800806294279,11.8234181165026,10.7137889764175,9.65256026715662,8.64103941759617,7.68047261675846,6.77204327851275,5.91687058361480,5.11600810088134,4.37044248919818,3.68109228196094,3.04880675544619,2.47436488250700,1.95847437288199,1.50177080130008,1.10481682445555,0.768101487817424,0.492039623127771,0.276971337330917,0.123161593563237,0.0307998847197954,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
            f = sum( sqrt(  (xh_t - xh_o).*(xh_t - xh_o) + (yh_t - yh_o).*(yh_t - yh_o)) )/360;

    catch
             f = 10^10; 
             xh_o = zeros(1,360);
             yh_o = zeros(1,360);
        end
    end
    
% 约束条件******************************************************************************
    % x为优化变量，不属于优化变量的可以用global引用； c<0;ceq=0;
    function [c,ceq] = YueShu(x)
        c = [];
        ceq = [];
    end

% 计算轨迹参数子函数 *********************************************************************************  
function  [index1,index2,h3,theta1,imp1] = zusers_get_parameters(xh,yh)
   % ============== step 1、台架轨迹的各种定位点的index ===========
   % 接地点index1和离地点index2
    Yg = yh; Xg = xh;
    Yg_L(1,1:180) = Yg(1,181:360); 
    Yg_L(1,181:360) = Yg(1,1:180); 
    DeltaY = abs(Yg_L-Yg);           %两腿高度差
    index = find(DeltaY == min(min(DeltaY)));
    if xh(index(1)) > xh(index(2))
        index1 = index(1);
        index2 = index(2);
    else
        index1 = index(2);
        index2 = index(1);
    end
%     plot(xh(index1),yh(index1),'*')
    if index1 <= 180 && index1 >2
        xh_ground = xh(index1:index2);
        yh_ground = yh(index1:index2);
    else        
        xh_ground = xh([index1:360,1:index2]);
        yh_ground = yh([index1:360,1:index2]);
    end
    h3 = max(yh_ground) - min(yh_ground);
    
    % 足地冲击
    AB = [xh(index1) - xh(index1+1), yh(index1) - yh(index1+1)];
    AX = [1,0];
    theta1 = acos(dot(AB,AX)/(norm(AB)*norm(AX)));
    T = 2;
    imp1 = (abs(yh(index1) - yh(index1+1)))/(T/360);  
end


% 杆组法子函数 *********************************************************************************
function [x2,y2] = crank(x1,y1,l1,phi)
    % R副主动件末端运动规律
    x2 = x1+l1*cos(phi);
    y2 = y1+l1*sin(phi);
end

function [x3,y3] = rigid_body(x1,y1,phi,a,b,M)
    % 如图rigid_body，求刚体上一点的C坐标（x3 y3）
    theta = atan(b/a); 
    x3 = x1 + sqrt(a^2+b^2)*cos(phi + M*theta);  
    y3 = y1 + sqrt(a^2+b^2)*sin(phi + M*theta);  %M = 1表示待求点（x3 y3）在上；反之在下
end

function [x3,y3,theta,phi3] = RRR(x1,y1,x2,y2,l2,l3,M)
    %用于RRR二级杆组，已知外副求内副。
    %x1 y1 x2 y2是两个外副坐标；l1 l2是两杆杆长；M=1表示正装
    %如图RRR1，正装时，点C在向量BD的左边;反装时，点C在向量BD的右边
    %如图RRR2，正装时，必定有theta = phi2 + alpha; 正装时，必定有theta = phi2 - alpha
    d = sqrt((x2-x1)^2 + (y2-y1)^2);
    phi2 = atan2((y2-y1),(x2-x1));
    alpha = acos((l2^2+d^2-l3^2)/(2*l2*d));
    theta = phi2+M*alpha;%M = 1,待求点（x3 y3）在上；反之在下
    x3 = x1 + l2*cos(theta);
    y3 = y1 + l2*sin(theta);
    phi3 = atan2((y3-y2),(x3-x2));
end

function [a,b] = sss2ab(l1,l2,l3)
    % 郭龙于20201216
   C = acos((l3^2 + l1^2 - l2^2)/(2*l3*l1)); 
   a = l3 * cos(C);
   b = l3 * sin(C);
end  

function [r1,r2,r3] = sab2sss(r1,a,b)
        r1 = r1;
        r2 = sqrt( (r1-a)^2 + b^2);
        r3 = sqrt(a^2 + b^2);
end
